version: '3.8'

services:
  telemon:
    build: .
    container_name: telemon
    restart: unless-stopped

    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - PROMETHEUS_URL=${PROMETHEUS_URL:-http://prometheus:9090}
      - GRAFANA_URL=${GRAFANA_URL:-http://grafana:3000}
      - GRAFANA_API_TOKEN=${GRAFANA_API_TOKEN}

    volumes:
      # Mount config file (optional, for custom configuration)
      - ./config/config.yaml:/app/config/config.yaml:ro

      # Persistent data storage
      - ./data:/app/data

      # Logs
      - ./logs:/app/logs

    # Expose webhook port for Alertmanager
    ports:
      - "9119:9119"

    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:9119/health', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    networks:
      - monitoring

networks:
  monitoring:
    # Use existing monitoring network if you have Prometheus/Grafana running
    # external: true
    driver: bridge
